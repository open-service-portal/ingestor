#!/usr/bin/env node

/**
 * Backstage Export CLI entry point
 * Auto-detects development vs production environment:
 * - Development: Uses ts-node to run TypeScript directly
 * - Production: Uses compiled JavaScript from dist/
 */

const path = require('path');
const fs = require('fs');

const rootDir = path.join(__dirname, '..');
const srcFile = path.join(rootDir, 'src/backstage-export/cli/backstage-export-cli.ts');
const distFile = path.join(rootDir, 'dist/backstage-export/cli/backstage-export-cli.js');

// Prefer compiled version if it exists (faster, no ts-node issues)
if (fs.existsSync(distFile)) {
  // console.error('Using compiled version:', distFile);
  require(distFile);
} else if (fs.existsSync(srcFile)) {
  // Fall back to ts-node in development
  console.error('Warning: Using ts-node (slow). Consider running "yarn build"');
  require('ts-node').register({
    project: path.join(rootDir, 'tsconfig.cli.json')
  });
  require(srcFile);
} else {
  console.error('Error: Neither source nor compiled files found.');
  console.error('Please run "yarn build" first.');
  process.exit(1);
}
